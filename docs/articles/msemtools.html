<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • msemtools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="msemtools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">msemtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.9.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/msemtools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="msemtools_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip></h1>
            
      
      
      <div class="hidden name"><code>msemtools.rmd</code></div>

    </div>

    
    
<div id="moderated-univariate-meta-analysis-in-metasem" class="section level1">
<h1 class="hasAnchor">
<a href="#moderated-univariate-meta-analysis-in-metasem" class="anchor"></a>Moderated univariate meta-analysis in MetaSEM</h1>
<p>For metaSEM you generally create a different model per moderation (e.g. age, gender, education). You can think of each moderated model as a regression with a predictor. A regression without predictors (just the intercept) just tells you the mean (the baseline model).</p>
<p>To give the basic flow of what we’re doing with metaSEM you can check out an analogy with regression:</p>
<p>Let’s use mtcars and miles per galon (mpg)</p>
<div id="baseline-model" class="section level2">
<h2 class="hasAnchor">
<a href="#baseline-model" class="anchor"></a>Baseline model</h2>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span><span class="op">)</span></pre></div>
<pre><code>## [1] 20.09062</code></pre>
<p>The baseline model’s intercept just gets you the mean of mpg</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="va">baseline</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="fl">1</span> , data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">baseline</span><span class="op">)</span></pre></div>
<pre><code>## (Intercept) 
##    20.09062</code></pre>
</div>
<div id="moderated-model" class="section level2">
<h2 class="hasAnchor">
<a href="#moderated-model" class="anchor"></a>Moderated model</h2>
<p>The moderated model gives you the relationship between another variable and miles per galon. E.g. the number of cylanders a car has.</p>
<p>Here are the average mpg per cylander</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="va">mtcars</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>avg_mpg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">)</span><span class="op">)</span></pre></div>
<pre><code>## # A tibble: 3 x 2
##     cyl avg_mpg
##   &lt;dbl&gt;   &lt;dbl&gt;
## 1     4    26.7
## 2     6    19.7
## 3     8    15.1</code></pre>
<p>Here’s the same information using a regression (analagous to a moderated meta-analsis):</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="va">moderated_model</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span> , data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">moderated_model</span><span class="op">)</span></pre></div>
<pre><code>## 
## Call:
## lm(formula = mpg ~ 1 + factor(cyl), data = mtcars)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.2636 -1.8357  0.0286  1.3893  7.2364 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   26.6636     0.9718  27.437  &lt; 2e-16 ***
## factor(cyl)6  -6.9208     1.5583  -4.441 0.000119 ***
## factor(cyl)8 -11.5636     1.2986  -8.905 8.57e-10 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 3.223 on 29 degrees of freedom
## Multiple R-squared:  0.7325, Adjusted R-squared:  0.714 
## F-statistic:  39.7 on 2 and 29 DF,  p-value: 4.979e-09</code></pre>
<p>The intercept is the average mpg at the reference level (cyl == 4). We can see that when cyl == 6, mpg is 6.92 points lower than the reference level. When it’s 8, it’s lower again. These values when added to the intercept match our averages calculated above.</p>
</div>
<div id="check-that-moderated-model-improves-baseline" class="section level2">
<h2 class="hasAnchor">
<a href="#check-that-moderated-model-improves-baseline" class="anchor"></a>Check that moderated model improves baseline</h2>
<p>We can then compare the moderated model to the baseline to see if it explains more variance.</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">baseline</span>, <span class="va">moderated_model</span><span class="op">)</span></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: mpg ~ 1
## Model 2: mpg ~ 1 + factor(cyl)
##   Res.Df     RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1     31 1126.05                                  
## 2     29  301.26  2    824.78 39.697 4.979e-09 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>Given the p-value is tiny, we can see the moderated model improves on the baseline model.</p>
</div>
</div>
<div id="metasem" class="section level1">
<h1 class="hasAnchor">
<a href="#metasem" class="anchor"></a>metaSEM</h1>
<p>We do a similar process with meta-analytic models. I’ll use a dataset in the metaSEM package you can play with.</p>
<p>In this dataset we are looking at the odds of women vs men getting grants. log-odds are the effect size (negative log-odds is less likely, positive log-odds is more likely). We use log-odds as they can be averaged together, whereas odds cannot.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">metaSEM</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/metaSEM/man/Bornmann07.html">Bornmann07</a></span></pre></div>
<div id="baseline-model-1" class="section level2">
<h2 class="hasAnchor">
<a href="#baseline-model-1" class="anchor"></a>Baseline model</h2>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mikewlcheung/metasem">metaSEM</a></span><span class="op">)</span>
<span class="va">baseline</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metaSEM/man/meta3.html">meta3</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">logOR</span>, v <span class="op">=</span> <span class="va">v</span>, cluster <span class="op">=</span> <span class="va">Cluster</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">baseline</span><span class="op">)</span></pre></div>
<pre><code>## 
## Call:
## meta3(y = logOR, v = v, cluster = Cluster, data = dat)
## 
## 95% confidence intervals: z statistic approximation (robust=FALSE)
## Coefficients:
##             Estimate  Std.Error     lbound     ubound z value Pr(&gt;|z|)  
## Intercept -0.1007784  0.0401327 -0.1794371 -0.0221198 -2.5111  0.01203 *
## Tau2_2     0.0037965  0.0027210 -0.0015367  0.0091297  1.3952  0.16295  
## Tau2_3     0.0141352  0.0091445 -0.0037877  0.0320580  1.5458  0.12216  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Q statistic on the homogeneity of effect sizes: 221.2809
## Degrees of freedom of the Q statistic: 65
## P value of the Q statistic: 0
## 
## Heterogeneity indices (based on the estimated Tau2):
##                               Estimate
## I2_2 (Typical v: Q statistic)   0.1568
## I2_3 (Typical v: Q statistic)   0.5839
## 
## Number of studies (or clusters): 21
## Number of observed statistics: 66
## Number of estimated parameters: 3
## Degrees of freedom: 63
## -2 log likelihood: 25.80256 
## OpenMx status1: 0 ("0" or "1": The optimization is considered fine.
## Other values may indicate problems.)</code></pre>
<p>The intercept (just like in the regression example) tells us the average log-odds for women getting grants. We can convert this to odds by taking its exponential</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">baseline</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></pre></div>
<pre><code>## Intercept 
## 0.9041333</code></pre>
<p>For every man that gets a grant, only .9 women get one.</p>
</div>
<div id="moderated-model-1" class="section level2">
<h2 class="hasAnchor">
<a href="#moderated-model-1" class="anchor"></a>Moderated model</h2>
<p>We can introduce predictor variables to our model to see if other variables are related to the odds of getting grants (just like regression). For example, perhaps the discipline of a grant proposal affects the odds of women vs men being successful?</p>
<div id="under-the-hood" class="section level3">
<h3 class="hasAnchor">
<a href="#under-the-hood" class="anchor"></a>Under the hood</h3>
<p>For the lm function, you just needed to tell R the variable and it creates the underlying matrices used in calculations. E.g. for mpg ~ cyl this is (more or less) what r did before doing calculations</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="va">cyl6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">cyl</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span>
<span class="va">cyl8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">cyl</span> <span class="op">==</span> <span class="fl">8</span><span class="op">)</span>
<span class="va">pred_matrix</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">cyl6</span>, <span class="va">cyl8</span><span class="op">)</span>

<span class="va">matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span>, intercept <span class="op">=</span> <span class="fl">1</span>, <span class="va">cyl6</span>, <span class="va">cyl8</span><span class="op">)</span>
<span class="va">matrix</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span></pre></div>
<pre><code>##         y intercept cyl6 cyl8
## [1,] 21.0         1    1    0
## [2,] 21.0         1    1    0
## [3,] 22.8         1    0    0
## [4,] 21.4         1    1    0
## [5,] 18.7         1    0    1</code></pre>
<p>R then uses this matrix to work out the regression slopes for each of the predictors (including for the intercept).</p>
<p>In metaSEM you have to construct the matrix of the predictors yourself. metaSEM then stitches the outcome, clustering variables, and your predictor matrix together. This final matrix is used with the OpenMx package to get model results.</p>
</div>
<div id="creating-the-predictor-matrix-for-metasem" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-the-predictor-matrix-for-metasem" class="anchor"></a>Creating the predictor matrix for metaSEM</h3>
<p>These are the disciplines in our dataset</p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">Discipline</span><span class="op">)</span></pre></div>
<pre><code>## [1] Physical sciences          Social sciences/humanities
## [3] Life sciences/biology      Multidisciplinary         
## 4 Levels: Physical sciences ... Multidisciplinary</code></pre>
<p>We leave off the first discipline (“Physical”) because if a grant isn’t in any of the other disciplines, it must be in the physical sciences. Adding an extra column with redundant information would give us really confusing results. What we’re doing by leaving off the first level is the same as what is done in regression using categorical variables.</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="va">Physical</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">Discipline</span> <span class="op">==</span> <span class="st">'Physical sciences'</span><span class="op">)</span>
<span class="va">Social</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">Discipline</span> <span class="op">==</span> <span class="st">'Social sciences/humanities'</span><span class="op">)</span>
<span class="va">Life</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">Discipline</span> <span class="op">==</span> <span class="st">'Life sciences/biology'</span><span class="op">)</span>
<span class="va">Multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">Discipline</span> <span class="op">==</span> <span class="st">'Multidisciplinary'</span><span class="op">)</span>

<span class="va">moderator_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Social</span>, <span class="va">Life</span>, <span class="va">Multi</span><span class="op">)</span>
<span class="va">moderator_matrix</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span> <span class="co"># I just show the first five rows.</span></pre></div>
<pre><code>##      Social Life Multi
## [1,]      0    0     0
## [2,]      0    0     0
## [3,]      0    0     0
## [4,]      0    0     0
## [5,]      1    0     0</code></pre>
<p>We then give that predictor matrix to metaSEM to perform the meta-regression.</p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="va">moderated_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metaSEM/man/meta3.html">meta3</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">logOR</span>, v <span class="op">=</span> <span class="va">v</span>, x <span class="op">=</span> <span class="va">moderator_matrix</span>, cluster <span class="op">=</span> <span class="va">Cluster</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">moderated_model</span><span class="op">)</span></pre></div>
<pre><code>## 
## Call:
## meta3(y = logOR, v = v, cluster = Cluster, x = moderator_matrix, 
##     data = dat)
## 
## 95% confidence intervals: z statistic approximation (robust=FALSE)
## Coefficients:
##             Estimate  Std.Error     lbound     ubound z value Pr(&gt;|z|)  
## Intercept -0.0238785  0.0764858 -0.1737878  0.1260308 -0.3122  0.75489  
## Slope_1   -0.2278263  0.1148709 -0.4529692 -0.0026835 -1.9833  0.04733 *
## Slope_2   -0.1170489  0.0824846 -0.2787157  0.0446178 -1.4190  0.15589  
## Slope_3    0.0091306  0.0994920 -0.1858701  0.2041313  0.0918  0.92688  
## Tau2_2     0.0039094  0.0028395 -0.0016559  0.0094747  1.3768  0.16857  
## Tau2_3     0.0071034  0.0064321 -0.0055033  0.0197101  1.1044  0.26944  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Q statistic on the homogeneity of effect sizes: 221.2809
## Degrees of freedom of the Q statistic: 65
## P value of the Q statistic: 0
## 
## Explained variances (R2):
##                          Level 2 Level 3
## Tau2 (no predictor)    0.0037965  0.0141
## Tau2 (with predictors) 0.0039094  0.0071
## R2                     0.0000000  0.4975
## 
## Number of studies (or clusters): 21
## Number of observed statistics: 66
## Number of estimated parameters: 6
## Degrees of freedom: 60
## -2 log likelihood: 20.07571 
## OpenMx status1: 0 ("0" or "1": The optimization is considered fine.
## Other values may indicate problems.)</code></pre>
<p>We can see the log-odds of physical sciences was -.02 (the intercept), Slope 1 to 3 are social sciences through multi-discipline. The slopes show the difference between physical science to a given level.</p>
<p>We can see this model’s fit is not significantly better than the baseline model (discipline may not affect how likely women are to get grants).</p>
<div class="sourceCode" id="cb24"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">moderated_model</span>, <span class="va">baseline</span><span class="op">)</span></pre></div>
<pre><code>##                    base            comparison ep minus2LL df        AIC
## 1 Meta analysis with ML                  &lt;NA&gt;  6 20.07571 60  -99.92429
## 2 Meta analysis with ML Meta analysis with ML  3 25.80256 63 -100.19744
##     diffLL diffdf         p
## 1       NA     NA        NA
## 2 5.726842      3 0.1256832</code></pre>
<p>If we wanted to just see the values for the slope without a reference level we could have just supplied all four categories and set the intercept to equal zero:</p>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="va">moderator_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">Physical</span>, <span class="va">Social</span>, <span class="va">Life</span>, <span class="va">Multi</span><span class="op">)</span>
<span class="va">moderated_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/metaSEM/man/meta3.html">meta3</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">logOR</span>, v <span class="op">=</span> <span class="va">v</span>, x <span class="op">=</span> <span class="va">moderator_matrix</span>,
                         intercept.constraints <span class="op">=</span> <span class="fl">0</span>, cluster <span class="op">=</span> <span class="va">Cluster</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">moderated_model</span><span class="op">)</span></pre></div>
<pre><code>## 
## Call:
## meta3(y = logOR, v = v, cluster = Cluster, x = moderator_matrix, 
##     data = dat, intercept.constraints = 0)
## 
## 95% confidence intervals: z statistic approximation (robust=FALSE)
## Coefficients:
##           Estimate  Std.Error     lbound     ubound z value Pr(&gt;|z|)   
## Slope_1 -0.0238785  0.0764858 -0.1737878  0.1260308 -0.3122 0.754892   
## Slope_2 -0.2517048  0.1016318 -0.4508995 -0.0525101 -2.4766 0.013263 * 
## Slope_3 -0.1409274  0.0438924 -0.2269550 -0.0548999 -3.2107 0.001324 **
## Slope_4 -0.0147478  0.0638994 -0.1399885  0.1104928 -0.2308 0.817472   
## Tau2_2   0.0039094  0.0028395 -0.0016559  0.0094747  1.3768 0.168573   
## Tau2_3   0.0071034  0.0064321 -0.0055033  0.0197101  1.1044 0.269435   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Q statistic on the homogeneity of effect sizes: 221.2809
## Degrees of freedom of the Q statistic: 65
## P value of the Q statistic: 0
## 
## Explained variances (R2):
##                          Level 2 Level 3
## Tau2 (no predictor)    0.0037965  0.0141
## Tau2 (with predictors) 0.0039094  0.0071
## R2                     0.0000000  0.4975
## 
## Number of studies (or clusters): 21
## Number of observed statistics: 66
## Number of estimated parameters: 6
## Degrees of freedom: 60
## -2 log likelihood: 20.07571 
## OpenMx status1: 0 ("0" or "1": The optimization is considered fine.
## Other values may indicate problems.)</code></pre>
<p>Note slope 1 and the previous model’s intercept are identical. Slopes 2:4 are changed as they are no longer relative to slope 1. They are relative to the intercept which we constrained to be zero (in other words they just give you the log odds for each of those disciplines).</p>
</div>
</div>
</div>
<div id="msemtools" class="section level1">
<h1 class="hasAnchor">
<a href="#msemtools" class="anchor"></a>msemtools</h1>
<p>All msemtools is, is a wrapper for metaSEM.</p>
<p>It is not on CRAN, it’s currently github-only. Install it like this:</p>
<div class="sourceCode" id="cb28"><pre class="downlit">
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"conig/msemtools"</span><span class="op">)</span></pre></div>
<p>msemtools makes the moderator matrices for you, renames the slopes and formats things to make life easier.</p>
<p>E.g.</p>
<div class="sourceCode" id="cb29"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">msemtools</span><span class="op">)</span></pre></div>
<pre><code>## A tiny thought...
## Copper hats rolling softly...
## Phil has big teal veils...
##                             [-_-]~</code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit">
<span class="va">mod_res</span> <span class="op">&lt;-</span> <span class="va">baseline</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/moderate.html">moderate</a></span><span class="op">(</span><span class="va">Discipline</span><span class="op">)</span>
<span class="va">mod_res</span></pre></div>
<pre><code>## Moderation results:
## 
## I2(2): 15.7%
## I2(3): 58.4%
## ------------------------------------
##   moderation  k  n R2_2 R2_3 p.value
## ------------------------------------
## 1 Discipline 21 66    0  0.5   0.13 
## ------------------------------------
## All models converged.</code></pre>
<p>We can see immediately that disciple is not a significant moderator. We can get the slopes like this:</p>
<div class="sourceCode" id="cb33"><pre class="downlit">
<span class="va">mod_res</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span>hide.insig <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></pre></div>
<pre><code>##   Moderator                    k  n  Estimate (95% CI)    SE   R^2(2) R^2(3)
## 1 Baseline                     21 66 -0.10 [-0.18, -0.02] 0.04 -      -     
## 2 Discipline                   21 66 -                    -    0.00   0.50  
## 3 __Physical sciences          5  14 -0.02 [-0.17, 0.13]  0.08 -      -     
## 4 __Life sciences/biology      12 26 -0.14 [-0.23, -0.05] 0.04 -      -     
## 5 __Social sciences/humanities 5  13 -0.25 [-0.45, -0.05] 0.10 -      -     
## 6 __Multidisciplinary          5  13 -0.01 [-0.14, 0.11]  0.06 -      -     
##   p   
## 1 -   
## 2 0.13
## 3 -   
## 4 -   
## 5 -   
## 6 -</code></pre>
<p>The way it does this is by automatically creating the matrices based on the predictors you give it. It them supplies the predictors to the metaSEM.</p>
<p>E.g.</p>
<div class="sourceCode" id="cb35"><pre class="downlit">
<span class="fu">msemtools</span><span class="fu">::</span><span class="fu"><a href="../reference/character_matrix.html">character_matrix</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">Discipline</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="op">]</span></pre></div>
<pre><code>##      Physical sciences Life sciences/biology Social sciences/humanities
## [1,]                 1                     0                          0
## [2,]                 1                     0                          0
## [3,]                 1                     0                          0
## [4,]                 1                     0                          0
## [5,]                 0                     0                          1
##      Multidisciplinary
## [1,]                 0
## [2,]                 0
## [3,]                 0
## [4,]                 0
## [5,]                 0</code></pre>
<p>One nice feature of msemtools is it helps you test multiple moderated models all in one step without having to set up all the matrices:</p>
<div class="sourceCode" id="cb37"><pre class="downlit">
<span class="va">res2</span> <span class="op">&lt;-</span> <span class="va">baseline</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/moderate.html">moderate</a></span><span class="op">(</span><span class="va">Discipline</span>, <span class="va">Type</span>, <span class="va">Year</span>, <span class="va">Country</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit">
<span class="va">res2</span></pre></div>
<pre><code>## Moderation results:
## 
## I2(2): 15.7%
## I2(3): 58.4%
## ------------------------------------
##   moderation  k  n R2_2 R2_3 p.value
## ------------------------------------
## 1 Discipline 21 66 0.00 0.50   0.13 
## 2       Type 21 66 0.07 0.79  0.004*
## 3       Year 21 66 0.05 0.00   1.00 
## 4    Country 21 66 0.12 0.66  0.020*
## ------------------------------------
## All models converged.</code></pre>
<p>The results should never be different to metaSEM (if they are, you’ve found a bug - let me know!), your code should just be more efficient.</p>
<div class="sourceCode" id="cb40"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">res2</span>, hide.insig <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></pre></div>
<pre><code>##    Moderator                    k  n  Estimate (95% CI)       SE    R^2(2)
## 1  Baseline                     21 66 -0.10 [-0.18, -0.02]    0.04  -     
## 2  Discipline                   21 66 -                       -     0.00  
## 3  __Physical sciences          5  14 -0.02 [-0.17, 0.13]     0.08  -     
## 4  __Life sciences/biology      12 26 -0.14 [-0.23, -0.05]    0.04  -     
## 5  __Social sciences/humanities 5  13 -0.25 [-0.45, -0.05]    0.10  -     
## 6  __Multidisciplinary          5  13 -0.01 [-0.14, 0.11]     0.06  -     
## 7  Type                         21 66 -                       -     0.07  
## 8  __Grant                      13 40 -0.01 [-0.08, 0.07]     0.04  -     
## 9  __Fellowship                 11 26 -0.20 [-0.28, -0.12]    0.04  -     
## 10 Year                         21 66 -                       -     0.05  
## 11 __Intercept                  -  -  -6.70 [-153.94, 140.53] 75.12 -     
## 12 __Year                       21 66 0.00 [-0.01, 0.02]      0.01  -     
## 13 Country                      21 66 -                       -     0.12  
## 14 __United States              4  12 0.00 [-0.11, 0.12]      0.06  -     
## 15 __Canada                     1  3  -0.13 [-0.33, 0.07]     0.10  -     
## 16 __Australia                  5  13 -0.02 [-0.20, 0.16]     0.09  -     
## 17 __United Kingdom             4  10 0.06 [-0.10, 0.21]      0.08  -     
## 18 __Europe                     7  28 -0.22 [-0.32, -0.12]    0.05  -     
##    R^2(3) p    
## 1  -      -    
## 2  0.50   0.13 
## 3  -      -    
## 4  -      -    
## 5  -      -    
## 6  -      -    
## 7  0.79   .004*
## 8  -      -    
## 9  -      -    
## 10 0.00   1.00 
## 11 -      -    
## 12 -      -    
## 13 0.66   .020*
## 14 -      -    
## 15 -      -    
## 16 -      -    
## 17 -      -    
## 18 -      -</code></pre>
<p>Also if you’re willing to play with LaTeX, or the github package ‘papaja’ you can automatically create moderator tables (in PDF or word). Note if you’re not using papaja you’ll need to add this to the YAML header to make this table in PDF documents:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>header<span class="op">-</span>includes<span class="op">:</span></span>
<span id="cb42-2"><a href="#cb42-2"></a><span class="st">  </span><span class="op">-</span><span class="st"> </span>\usepackage{threeparttable}</span>
<span id="cb42-3"><a href="#cb42-3"></a>  <span class="op">-</span><span class="st"> </span>\usepackage{booktabs}</span>
<span id="cb42-4"><a href="#cb42-4"></a>  <span class="op">-</span><span class="st"> </span>\usepackage{float}</span></code></pre></div>
<div style="page-break-after: always;"></div>
<div class="sourceCode" id="cb43"><pre class="downlit">
<span class="va">res2</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/format_nicely.html">format_nicely</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/to_apa.html">to_apa</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Moderator analysis results"</span>,
         note <span class="op">=</span> <span class="st">"p-values are from likelihood ratio tests comparing the baseline model to moderated models"</span><span class="op">)</span></pre></div>
<caption>
(#tab:unnamed-chunk-22)
</caption>
<div custom-style="Table Caption">
<em>Moderator analysis results</em>
</div>
<table class="table">
<thead><tr class="header">
<th align="left">Moderator</th>
<th align="left">k</th>
<th align="left">n</th>
<th align="left">Estimate (95% CI)</th>
<th align="left"><span class="math inline">\(SE\)</span></th>
<th align="left"><span class="math inline">\(R^2_{(2)}\)</span></th>
<th align="left"><span class="math inline">\(R^2_{(3)}\)</span></th>
<th align="left"><span class="math inline">\(p\)</span></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Baseline (<span class="math inline">\(I^2_{(2;3)}\)</span>: 0.16; 0.58)</td>
<td align="left">21</td>
<td align="left">66</td>
<td align="left">-0.10 [-0.18, -0.02]</td>
<td align="left">0.04</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td align="left">Discipline</td>
<td align="left">21</td>
<td align="left">66</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">0.00</td>
<td align="left">0.50</td>
<td align="left">0.13</td>
</tr>
<tr class="odd">
<td align="left">Type</td>
<td align="left">21</td>
<td align="left">66</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">0.07</td>
<td align="left">0.79</td>
<td align="left">.004*</td>
</tr>
<tr class="even">
<td align="left">   Grant</td>
<td align="left">13</td>
<td align="left">40</td>
<td align="left">-0.01 [-0.08, 0.07]</td>
<td align="left">0.04</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
<tr class="odd">
<td align="left">   Fellowship</td>
<td align="left">11</td>
<td align="left">26</td>
<td align="left">-0.20 [-0.28, -0.12]</td>
<td align="left">0.04</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td align="left">Year</td>
<td align="left">21</td>
<td align="left">66</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">0.05</td>
<td align="left">0.00</td>
<td align="left">1.00</td>
</tr>
<tr class="odd">
<td align="left">Country</td>
<td align="left">21</td>
<td align="left">66</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">0.12</td>
<td align="left">0.66</td>
<td align="left">.020*</td>
</tr>
<tr class="even">
<td align="left">   United States</td>
<td align="left">4</td>
<td align="left">12</td>
<td align="left">0.00 [-0.11, 0.12]</td>
<td align="left">0.06</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
<tr class="odd">
<td align="left">   Canada</td>
<td align="left">1</td>
<td align="left">3</td>
<td align="left">-0.13 [-0.33, 0.07]</td>
<td align="left">0.10</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td align="left">   Australia</td>
<td align="left">5</td>
<td align="left">13</td>
<td align="left">-0.02 [-0.20, 0.16]</td>
<td align="left">0.09</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
<tr class="odd">
<td align="left">   United Kingdom</td>
<td align="left">4</td>
<td align="left">10</td>
<td align="left">0.06 [-0.10, 0.21]</td>
<td align="left">0.08</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
<tr class="even">
<td align="left">   Europe</td>
<td align="left">7</td>
<td align="left">28</td>
<td align="left">-0.22 [-0.32, -0.12]</td>
<td align="left">0.05</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
</tbody>
</table>
<div custom-style="Compact">
<p><em>Note.</em> p-values are from likelihood ratio tests comparing the baseline model to moderated models</p>
</div>
<p> </p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by James Conigrave.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
